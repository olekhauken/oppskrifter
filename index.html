<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Oppskrifter">
<meta name="theme-color" content="#1a1a0e">
<title>Oppskrifter</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #1a1a0e; --bg2: #242416; --bg3: #2e2e1c; --card: #2a2a18;
    --accent: #c8a84b; --accent2: #e8c97a; --text: #f0ead6; --text2: #a09880;
    --danger: #c05a3a; --success: #5a8a4a; --border: rgba(200,168,75,0.2);
    --radius: 16px; --shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
  .view { display: none; min-height: 100vh; padding-bottom: 80px; }
  .view.active { display: block; }
  nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg2); border-top: 1px solid var(--border); display: flex; z-index: 100; padding-bottom: env(safe-area-inset-bottom); }
  nav button { flex: 1; padding: 12px 8px; background: none; border: none; color: var(--text2); font-family: 'DM Sans', sans-serif; font-size: 11px; font-weight: 500; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: color 0.2s; }
  nav button.active { color: var(--accent); }
  nav button svg { width: 22px; height: 22px; }
  .header { padding: 60px 20px 20px; background: linear-gradient(180deg, var(--bg) 0%, transparent 100%); }
  .header h1 { font-family: 'Playfair Display', serif; font-size: 32px; color: var(--accent); }
  .header p { color: var(--text2); font-size: 14px; margin-top: 4px; }
  .sync-status { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text2); padding: 0 20px 8px; }
  .sync-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--text2); flex-shrink: 0; }
  .sync-dot.online { background: var(--success); }
  .sync-dot.syncing { background: var(--accent); animation: pulse 1s infinite; }
  .sync-dot.offline { background: var(--danger); }
  @keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.4} }
  .search-bar { margin: 0 20px 20px; position: relative; }
  .search-bar input { width: 100%; padding: 12px 16px 12px 44px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; outline: none; }
  .search-bar input::placeholder { color: var(--text2); }
  .search-bar svg { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text2); width: 18px; height: 18px; }
  .categories { display: flex; gap: 8px; padding: 0 20px 16px; overflow-x: auto; scrollbar-width: none; }
  .categories::-webkit-scrollbar { display: none; }
  .cat-pill { padding: 6px 16px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--text2); font-size: 13px; font-family: 'DM Sans', sans-serif; white-space: nowrap; cursor: pointer; transition: all 0.2s; }
  .cat-pill.active { background: var(--accent); border-color: var(--accent); color: var(--bg); font-weight: 500; }
  .recipe-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 20px; }
  .recipe-card { background: var(--card); border-radius: 12px; overflow: hidden; cursor: pointer; border: 1px solid var(--border); transition: transform 0.15s; display: flex; flex-direction: column; }
  .recipe-card:active { transform: scale(0.97); }
  .recipe-card .card-img { width: 100%; height: 36px; background: var(--bg3); display: flex; align-items: center; justify-content: center; font-size: 20px; overflow: hidden; }
  .recipe-card .card-img img { width: 100%; height: 120px; object-fit: cover; }
  .recipe-card .card-body { padding: 8px 10px 10px; flex: 1; }
  .recipe-card .card-title { font-family: 'Playfair Display', serif; font-size: 13px; color: var(--text); line-height: 1.3; }
  .recipe-card .card-meta { font-size: 11px; color: var(--text2); margin-top: 2px; }
  .recipe-card .card-cat { display: inline-block; font-size: 10px; background: var(--bg3); color: var(--accent); padding: 1px 6px; border-radius: 8px; margin-top: 4px; }
  .empty-state { text-align: center; padding: 60px 40px; color: var(--text2); }
  .empty-state .icon { font-size: 60px; margin-bottom: 16px; }
  .empty-state h3 { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--text); margin-bottom: 8px; }
  .fab { position: fixed; bottom: 80px; right: 20px; width: 56px; height: 56px; border-radius: 50%; background: var(--accent); border: none; color: var(--bg); font-size: 28px; cursor: pointer; box-shadow: 0 4px 20px rgba(200,168,75,0.4); z-index: 99; display: flex; align-items: center; justify-content: center; transition: transform 0.15s; }
  .fab:active { transform: scale(0.93); }
  .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 200; backdrop-filter: blur(4px); }
  .overlay.active { display: block; }
  .sheet { position: fixed; bottom: 0; left: 0; right: 0; background: var(--bg2); border-radius: 24px 24px 0 0; z-index: 201; max-height: 95vh; overflow-y: auto; padding-bottom: env(safe-area-inset-bottom); transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.4,0,0.2,1); }
  .sheet.active { transform: translateY(0); }
  .sheet-handle { width: 40px; height: 4px; background: var(--bg3); border-radius: 2px; margin: 12px auto 20px; }
  .sheet-title { font-family: 'Playfair Display', serif; font-size: 22px; color: var(--accent); padding: 0 20px 16px; }
  .form-group { padding: 0 20px 16px; }
  .form-group label { display: block; font-size: 12px; font-weight: 500; color: var(--text2); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
  .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px 14px; background: var(--bg3); border: 1px solid var(--border); border-radius: 12px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; outline: none; }
  .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--accent); }
  .form-group textarea { min-height: 80px; resize: vertical; }
  .form-group select option { background: var(--bg2); }
  .ingredient-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
  .ingredient-row input { flex: 1; }
  .ingredient-row input.qty { width: 70px; flex: none; }
  .ingredient-row select { width: 90px; flex: none; }
  .ingredient-row button { width: 36px; height: 36px; border-radius: 8px; border: none; background: var(--danger); color: white; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .add-ingredient-btn { width: 100%; padding: 10px; border: 1px dashed var(--border); border-radius: 10px; background: transparent; color: var(--accent); font-family: 'DM Sans', sans-serif; font-size: 14px; cursor: pointer; }
  .step-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: flex-start; }
  .step-num { width: 28px; height: 28px; border-radius: 50%; background: var(--accent); color: var(--bg); font-size: 13px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 10px; }
  .step-row textarea { flex: 1; min-height: 60px; }
  .step-row button { width: 36px; height: 36px; border-radius: 8px; border: none; background: var(--danger); color: white; font-size: 18px; cursor: pointer; flex-shrink: 0; margin-top: 6px; }
  .btn-primary { width: calc(100% - 40px); margin: 4px 20px 16px; padding: 16px; background: var(--accent); border: none; border-radius: 14px; color: var(--bg); font-family: 'DM Sans', sans-serif; font-size: 16px; font-weight: 600; cursor: pointer; }
  .btn-secondary { width: calc(100% - 40px); margin: 0 20px 12px; padding: 14px; background: transparent; border: 1px solid var(--border); border-radius: 14px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; cursor: pointer; }
  .btn-danger { background: var(--danger); border-color: var(--danger); color: white; }
  .detail-hero { width: 100%; aspect-ratio: 16/9; background: var(--bg3); display: flex; align-items: center; justify-content: center; font-size: 80px; overflow: hidden; }
  .detail-hero img { width: 100%; height: 100%; object-fit: cover; }
  .detail-content { padding: 20px; }
  .detail-title { font-family: 'Playfair Display', serif; font-size: 28px; color: var(--text); line-height: 1.2; }
  .detail-meta { display: flex; gap: 16px; margin: 12px 0; color: var(--text2); font-size: 13px; }
  .detail-section { margin-top: 24px; }
  .detail-section h3 { font-family: 'Playfair Display', serif; font-size: 18px; color: var(--accent); margin-bottom: 12px; }
  .ing-list { list-style: none; }
  .ing-list li { padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 15px; display: flex; justify-content: space-between; }
  .ing-list li .ing-amount { color: var(--accent); font-weight: 500; }
  .step-list { list-style: none; counter-reset: steps; }
  .step-list li { counter-increment: steps; padding: 12px 0 12px 44px; border-bottom: 1px solid var(--border); font-size: 15px; line-height: 1.6; position: relative; }
  .step-list li::before { content: counter(steps); position: absolute; left: 0; top: 12px; width: 28px; height: 28px; background: var(--accent); color: var(--bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; }
  .detail-notes { background: var(--bg3); border-radius: 12px; padding: 14px; font-size: 14px; color: var(--text2); line-height: 1.6; margin-top: 12px; border-left: 3px solid var(--accent); }
  .ai-view { padding: 20px; }
  .camera-area { border: 2px dashed var(--border); border-radius: var(--radius); padding: 40px 20px; text-align: center; cursor: pointer; margin-bottom: 16px; }
  .camera-area .cam-icon { font-size: 48px; margin-bottom: 12px; }
  .camera-area p { color: var(--text2); font-size: 14px; }
  .camera-area input[type=file] { display: none; }
  #preview-img { width: 100%; border-radius: var(--radius); margin-bottom: 16px; display: none; }
  .ai-result { background: var(--card); border-radius: var(--radius); padding: 16px; border: 1px solid var(--border); display: none; }
  .ai-result h3 { font-family: 'Playfair Display', serif; font-size: 18px; color: var(--accent); margin-bottom: 8px; }
  .ai-result pre { font-size: 13px; color: var(--text2); white-space: pre-wrap; line-height: 1.6; font-family: 'DM Sans', sans-serif; }
  .api-key-section { background: var(--card); border-radius: var(--radius); padding: 16px; border: 1px solid var(--border); margin-bottom: 16px; }
  .api-key-section p { font-size: 13px; color: var(--text2); margin-bottom: 10px; line-height: 1.5; }
  .api-key-section a { color: var(--accent); }
  .settings-view { padding: 20px; }
  .settings-section { background: var(--card); border-radius: var(--radius); border: 1px solid var(--border); margin-bottom: 16px; overflow: hidden; }
  .settings-row { padding: 14px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .settings-row:last-child { border-bottom: none; }
  .settings-row label { font-size: 14px; }
  .settings-row input { background: var(--bg3); border: 1px solid var(--border); border-radius: 8px; padding: 8px 10px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 14px; flex: 1; margin-left: 12px; outline: none; }
  .settings-label { font-size: 12px; font-weight: 500; color: var(--text2); text-transform: uppercase; letter-spacing: 0.5px; padding: 12px 16px 4px; }
  .loading { display: none; text-align: center; padding: 20px; }
  .spinner { width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 12px; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px); background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 10px 20px; font-size: 14px; z-index: 300; transition: transform 0.3s; white-space: nowrap; }
  .toast.show { transform: translateX(-50%) translateY(0); }
  .scale-bar { display: flex; align-items: center; gap: 12px; background: var(--bg3); border-radius: 12px; padding: 10px 14px; margin: 12px 0; }
  .scale-bar label { font-size: 13px; color: var(--text2); }
  .scale-bar input[type=range] { flex: 1; accent-color: var(--accent); }
  .scale-bar span { font-size: 14px; font-weight: 600; color: var(--accent); min-width: 30px; }
  #init-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; }
  #init-overlay .big-spinner { width: 48px; height: 48px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
  #init-overlay p { color: var(--text2); font-size: 14px; }
</style>
</head>
<body>

<div id="init-overlay">
  <div class="big-spinner"></div>
  <p>Laster oppskrifter...</p>
</div>

<div class="view active" id="view-home">
  <div class="header">
    <h1>Oppskrifter</h1>
    <p id="recipe-count">0 oppskrifter</p>
  </div>
  <div class="sync-status">
    <div class="sync-dot syncing" id="sync-dot"></div>
    <span id="sync-label">Kobler til...</span>
  </div>
  <div class="search-bar">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
    <input type="text" id="search-input" placeholder="S√∏k etter oppskrift...">
  </div>
  <div class="categories">
    <button class="cat-pill active" data-cat="alle">Alle</button>
    <button class="cat-pill" data-cat="Frokost">Frokost</button>
    <button class="cat-pill" data-cat="Lunsj">Lunsj</button>
    <button class="cat-pill" data-cat="Middag">Middag</button>
    <button class="cat-pill" data-cat="Dessert">Dessert</button>
    <button class="cat-pill" data-cat="Bakst">Bakst</button>
    <button class="cat-pill" data-cat="Snacks">Snacks</button>
    <button class="cat-pill" data-cat="Drikke">Drikke</button>
  </div>
  <div class="recipe-grid" id="recipe-grid"></div>
  <div class="empty-state" id="empty-state" style="display:none">
    <div class="icon">üçΩÔ∏è</div>
    <h3>Ingen oppskrifter enn√•</h3>
    <p>Trykk + for √• legge til din f√∏rste oppskrift</p>
  </div>
</div>

<div class="view" id="view-camera">
  <div class="header"><h1>Scan oppskrift</h1><p>Ta bilde eller last opp</p></div>
  <div class="ai-view">
    <div class="api-key-section" id="api-key-section">
      <p>For √• bruke AI-scanning trenger du en <strong>Anthropic API-n√∏kkel</strong>.<br>
      G√• til <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> ‚Üí API Keys ‚Üí Create Key</p>
      <div class="form-group" style="padding:0;margin-top:8px;"><input type="password" id="api-key-input" placeholder="sk-ant-..."></div>
      <button class="btn-primary" style="margin:8px 0 0;width:100%;" onclick="saveApiKey()">Lagre n√∏kkel</button>
    </div>
    <div style="margin-bottom:16px;">
      <div style="font-size:12px;font-weight:500;color:var(--text2);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;">Hent fra nettside</div>
      <div style="display:flex;gap:8px;">
        <input type="url" id="url-input" placeholder="https://www.matprat.no/oppskrifter/..."
          style="flex:1;padding:12px 14px;background:var(--bg3);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;">
        <button onclick="analyzeUrl()" style="padding:12px 16px;background:var(--accent);border:none;border-radius:12px;color:var(--bg);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap;">Hent</button>
      </div>
    </div>
    <div style="text-align:center;color:var(--text2);font-size:13px;margin-bottom:16px;">‚Äî eller ‚Äî</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
      <div class="camera-area" onclick="document.getElementById('file-camera').click()" style="margin-bottom:0;">
        <div class="cam-icon">üì∑</div>
        <p>Ta bilde</p>
        <input type="file" id="file-camera" accept="image/*" capture="environment" onchange="handleImage(this)">
      </div>
      <div class="camera-area" onclick="document.getElementById('file-library').click()" style="margin-bottom:0;">
        <div class="cam-icon">üñºÔ∏è</div>
        <p>Velg fra bibliotek</p>
        <input type="file" id="file-library" accept="image/*" onchange="handleImage(this)">
      </div>
    </div>
    <img id="preview-img" alt="Forh√•ndsvisning">
    <div class="loading" id="ai-loading"><div class="spinner"></div><p>Leser oppskrift...</p></div>
    <div class="ai-result" id="ai-result">
      <h3>Funnet oppskrift: <span id="ai-recipe-title" style="color:var(--text);font-style:italic;"></span></h3>
      <pre id="ai-text"></pre>
      <button class="btn-primary" style="margin:16px 0 0;width:100%;" onclick="importAiRecipe()">Importer som oppskrift</button>
    </div>
  </div>
</div>

<div class="view" id="view-settings">
  <div class="header"><h1>Innstillinger</h1></div>
  <div class="settings-view">
    <div class="settings-label">API</div>
    <div class="settings-section">
      <div class="settings-row">
        <label>Anthropic API-n√∏kkel</label>
        <input type="password" id="settings-api-key" placeholder="sk-ant-..." oninput="saveApiKeyFromSettings()">
      </div>
    </div>
    <div class="settings-label">Sky-lagring</div>
    <div class="settings-section">
      <div class="settings-row">
        <label>Firebase status</label>
        <span id="firebase-status" style="color:var(--text2);font-size:13px;">Laster...</span>
      </div>
    </div>
    <div class="settings-label">Data</div>
    <div class="settings-section">
      <div class="settings-row" style="cursor:pointer" onclick="exportData()">
        <label>Eksporter alle oppskrifter</label><span style="color:var(--accent)">‚Üí</span>
      </div>
      <div class="settings-row" style="cursor:pointer" onclick="document.getElementById('import-file').click()">
        <label>Importer oppskrifter</label><span style="color:var(--accent)">‚Üí</span>
        <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(this)">
      </div>
      <div class="settings-row" style="cursor:pointer" onclick="clearAllData()">
        <label style="color:var(--danger)">Slett alle oppskrifter</label><span style="color:var(--danger)">‚Üí</span>
      </div>
    </div>
    <div class="settings-label">Om appen</div>
    <div class="settings-section">
      <div class="settings-row"><label>Versjon</label><span style="color:var(--text2)">2.0 (Firebase)</span></div>
      <div class="settings-row"><label>Oppskrifter lagret</label><span id="total-count" style="color:var(--text2)">0</span></div>
    </div>
  </div>
</div>

<nav>
  <button class="active" onclick="showView('home')" id="nav-home">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
    Hjem
  </button>
  <button onclick="showView('camera')" id="nav-camera">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
    Scan
  </button>
  <button onclick="showView('settings')" id="nav-settings">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
    Innstillinger
  </button>
</nav>

<button class="fab" onclick="openAddSheet()" id="fab-btn">+</button>

<div class="overlay" id="overlay" onclick="closeSheet()"></div>
<div class="sheet" id="sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title" id="sheet-title">Ny oppskrift</div>
  <div class="form-group"><label>Navn p√• oppskrift</label><input type="text" id="f-name" placeholder="F.eks. Spaghetti Carbonara"></div>
  <div class="form-group"><label>Kategori</label>
    <select id="f-cat">
      <option value="Middag">Middag</option><option value="Frokost">Frokost</option>
      <option value="Lunsj">Lunsj</option><option value="Dessert">Dessert</option>
      <option value="Bakst">Bakst</option><option value="Snacks">Snacks</option>
      <option value="Drikke">Drikke</option><option value="Annet">Annet</option>
    </select>
  </div>
  <div class="form-group" style="display:flex;gap:12px;">
    <div style="flex:1"><label>Porsjoner</label><input type="number" id="f-portions" placeholder="4" min="1"></div>
    <div style="flex:1"><label>Tid (min)</label><input type="number" id="f-time" placeholder="30" min="0"></div>
  </div>
  <div class="form-group">
    <label>Ingredienser</label>
    <div id="ingredients-list"></div>
    <button class="add-ingredient-btn" onclick="addIngredientRow()">+ Legg til ingrediens</button>
  </div>
  <div class="form-group">
    <label>Fremgangsm√•te</label>
    <div id="steps-list"></div>
    <button class="add-ingredient-btn" onclick="addStepRow()">+ Legg til steg</button>
  </div>
  <div class="form-group"><label>Notater (valgfritt)</label><textarea id="f-notes" placeholder="Tips, variasjoner, allergier..."></textarea></div>
  <button class="btn-primary" onclick="saveRecipe()">Lagre oppskrift</button>
  <button class="btn-secondary btn-danger" id="delete-btn" onclick="deleteRecipe()" style="display:none">Slett oppskrift</button>
  <button class="btn-secondary" onclick="closeSheet()">Avbryt</button>
  <div style="height:20px"></div>
</div>

<div class="overlay" id="detail-overlay" onclick="closeDetail()"></div>
<div class="sheet" id="detail-sheet">
  <div style="position:relative;">
    <button onclick="closeDetail()" style="position:absolute;top:12px;left:12px;z-index:10;background:rgba(0,0,0,0.5);border:none;border-radius:50%;width:36px;height:36px;color:white;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px);">‚Äπ</button>
    <div id="detail-hero" class="detail-hero">üçΩÔ∏è</div>
  </div>
  <div class="detail-content">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;">
      <div class="detail-title" id="d-title"></div>
      <button onclick="editCurrentRecipe()" style="background:var(--bg3);border:1px solid var(--border);color:var(--accent);padding:8px 14px;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:13px;cursor:pointer;">Rediger</button>
    </div>
    <div class="detail-meta">
      <span id="d-cat"></span><span id="d-time"></span><span id="d-portions-display"></span>
    </div>
    <div class="scale-bar">
      <label>Porsjoner:</label>
      <input type="range" id="scale-range" min="1" max="20" value="4" oninput="updateScale(this.value)">
      <span id="scale-val">4</span>
    </div>
    <div class="detail-section" id="d-ing-section"><h3>Ingredienser</h3><ul class="ing-list" id="d-ingredients"></ul></div>
    <div class="detail-section" id="d-steps-section"><h3>Fremgangsm√•te</h3><ol class="step-list" id="d-steps"></ol></div>
    <div class="detail-section" id="d-notes-section" style="display:none"><h3>Notater</h3><div class="detail-notes" id="d-notes"></div></div>
    <div style="height:20px"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getFirestore, collection, doc, addDoc, setDoc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyC1ZD2vHrebdFCXT-gtFiOHWtUOcX2b2iw",
  authDomain: "oppskrifter-e83b1.firebaseapp.com",
  projectId: "oppskrifter-e83b1",
  storageBucket: "oppskrifter-e83b1.firebasestorage.app",
  messagingSenderId: "821217031410",
  appId: "1:821217031410:web:ee6c08d36c330d2d548c6b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const recipesCol = collection(db, 'oppskrifter');

const UNITS = ['ts', 'ss', 'ml', 'cl', 'dl', 'l', 'g', 'kg', 'stk', 'neve', 'klype', 'pakke', ''];
let recipes = [];
let currentEditId = null;
let currentDetailId = null;
let currentCat = 'alle';
let searchQuery = '';
let detailRecipe = null;
let scaleMultiplier = 1;
let currentImageBase64 = null;
let parsedAiRecipe = null;

function setSyncStatus(state, label) {
  const dot = document.getElementById('sync-dot');
  const lbl = document.getElementById('sync-label');
  if (dot) { dot.className = 'sync-dot ' + state; }
  if (lbl) lbl.textContent = label;
  const fs = document.getElementById('firebase-status');
  if (fs) fs.textContent = label;
}

const q = query(recipesCol, orderBy('created', 'desc'));
onSnapshot(q, (snapshot) => {
  recipes = snapshot.docs.map(d => ({ ...d.data(), id: d.id }));
  document.getElementById('init-overlay').style.display = 'none';
  setSyncStatus('online', 'Synkronisert ‚úì');
  renderGrid();
  const tc = document.getElementById('total-count');
  if (tc) tc.textContent = recipes.length;
}, (error) => {
  console.error(error);
  document.getElementById('init-overlay').style.display = 'none';
  setSyncStatus('offline', 'Frakoblet');
  showToast('Tilkoblingsfeil ‚Äì sjekk internett');
});

async function firestoreSave(recipe) {
  setSyncStatus('syncing', 'Lagrer...');
  const { id, ...data } = recipe;
  if (id) {
    await setDoc(doc(db, 'oppskrifter', id), data);
  } else {
    await addDoc(recipesCol, data);
  }
}

async function firestoreDelete(id) {
  setSyncStatus('syncing', 'Sletter...');
  await deleteDoc(doc(db, 'oppskrifter', id));
}

window.showView = function(name) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  document.getElementById('nav-' + name).classList.add('active');
  document.getElementById('fab-btn').style.display = name === 'home' ? 'flex' : 'none';
  if (name === 'home') renderGrid();
  if (name === 'settings') {
    document.getElementById('settings-api-key').value = getApiKey() || '';
    document.getElementById('total-count').textContent = recipes.length;
  }
};

function renderGrid() {
  const grid = document.getElementById('recipe-grid');
  const empty = document.getElementById('empty-state');
  const count = document.getElementById('recipe-count');
  let filtered = recipes;
  if (currentCat !== 'alle') filtered = filtered.filter(r => r.category === currentCat);
  if (searchQuery) {
    const sq = searchQuery.toLowerCase();
    filtered = filtered.filter(r => r.name.toLowerCase().includes(sq) ||
      (r.ingredients || []).some(i => i.name.toLowerCase().includes(sq)));
  }
  count.textContent = recipes.length + ' oppskrift' + (recipes.length !== 1 ? 'er' : '');
  grid.innerHTML = '';
  if (!filtered.length) { empty.style.display = 'block'; return; }
  empty.style.display = 'none';
  filtered.forEach(r => {
    const card = document.createElement('div');
    card.className = 'recipe-card';
    const imgHtml = r.image ? `<div class="card-img"><img src="${r.image}" alt="${r.name}"></div>` : `<div class="card-img">${catEmoji(r.category)}</div>`;
    card.innerHTML = `${imgHtml}<div class="card-body"><div class="card-title">${r.name}</div><div class="card-meta">${r.time ? r.time+' min' : ''}${r.time&&r.portions?' ¬∑ ':''}${r.portions ? r.portions+' porsjoner':''}</div><div class="card-cat">${r.category||'Annet'}</div></div>`;
    card.onclick = () => openDetail(r.id);
    grid.appendChild(card);
  });
}

function catEmoji(cat) {
  return ({Frokost:'ü•£',Lunsj:'ü•ó',Middag:'üçΩÔ∏è',Dessert:'üç∞',Bakst:'üßÅ',Snacks:'üçø',Drikke:'‚òï',Annet:'üç¥'})[cat] || 'üç¥';
}

document.getElementById('search-input').addEventListener('input', function() { searchQuery = this.value; renderGrid(); });
document.querySelectorAll('.cat-pill').forEach(btn => btn.addEventListener('click', function() {
  document.querySelectorAll('.cat-pill').forEach(b => b.classList.remove('active'));
  this.classList.add('active');
  currentCat = this.dataset.cat;
  renderGrid();
}));

window.openAddSheet = function() {
  currentEditId = null;
  document.getElementById('sheet-title').textContent = 'Ny oppskrift';
  document.getElementById('delete-btn').style.display = 'none';
  ['f-name','f-portions','f-time','f-notes'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('f-cat').value = 'Middag';
  document.getElementById('ingredients-list').innerHTML = '';
  document.getElementById('steps-list').innerHTML = '';
  addIngredientRow(); addStepRow(); showSheet();
};

window.editCurrentRecipe = function() {
  closeDetail();
  const r = recipes.find(x => x.id === currentDetailId);
  if (!r) return;
  currentEditId = r.id;
  document.getElementById('sheet-title').textContent = 'Rediger oppskrift';
  document.getElementById('delete-btn').style.display = 'block';
  document.getElementById('f-name').value = r.name||'';
  document.getElementById('f-cat').value = r.category||'Middag';
  document.getElementById('f-portions').value = r.portions||'';
  document.getElementById('f-time').value = r.time||'';
  document.getElementById('f-notes').value = r.notes||'';
  document.getElementById('ingredients-list').innerHTML = '';
  (r.ingredients||[]).forEach(i => addIngredientRow(i));
  if (!r.ingredients?.length) addIngredientRow();
  document.getElementById('steps-list').innerHTML = '';
  (r.steps||[]).forEach(s => addStepRow(s));
  if (!r.steps?.length) addStepRow();
  showSheet();
};

function showSheet() {
  document.getElementById('overlay').classList.add('active');
  document.getElementById('sheet').classList.add('active');
  setTimeout(() => document.getElementById('f-name').focus(), 400);
}
window.closeSheet = function() {
  document.getElementById('overlay').classList.remove('active');
  document.getElementById('sheet').classList.remove('active');
};

window.addIngredientRow = function(data={}) {
  const list = document.getElementById('ingredients-list');
  const row = document.createElement('div');
  row.className = 'ingredient-row';
  const opts = UNITS.map(u => `<option value="${u}" ${u===(data.unit||'')?'selected':''}>${u||'‚Äî'}</option>`).join('');
  row.innerHTML = `<input class="qty" type="text" placeholder="Mengde" value="${data.amount||''}" inputmode="decimal"><select>${opts}</select><input type="text" placeholder="Ingrediens" value="${data.name||''}"><button onclick="this.parentElement.remove()">√ó</button>`;
  list.appendChild(row);
};

window.addStepRow = function(text='') {
  const list = document.getElementById('steps-list');
  const num = list.children.length + 1;
  const row = document.createElement('div');
  row.className = 'step-row';
  row.innerHTML = `<div class="step-num">${num}</div><textarea placeholder="Beskriv steget...">${text}</textarea><button onclick="this.parentElement.remove();updateStepNumbers()">√ó</button>`;
  list.appendChild(row);
};
window.updateStepNumbers = function() {
  document.querySelectorAll('#steps-list .step-num').forEach((el,i) => el.textContent=i+1);
};

window.saveRecipe = async function() {
  const name = document.getElementById('f-name').value.trim();
  if (!name) { showToast('Skriv inn et navn!'); return; }
  const ingredients = [];
  document.querySelectorAll('#ingredients-list .ingredient-row').forEach(row => {
    const inputs = row.querySelectorAll('input');
    const sel = row.querySelector('select');
    const n = inputs[1].value.trim();
    if (n) ingredients.push({amount:inputs[0].value.trim(), unit:sel.value, name:n});
  });
  const steps = [];
  document.querySelectorAll('#steps-list textarea').forEach(ta => { const t=ta.value.trim(); if(t) steps.push(t); });
  const existingCreated = currentEditId ? recipes.find(r=>r.id===currentEditId)?.created : null;
  const recipe = {
    id: currentEditId||null, name,
    category: document.getElementById('f-cat').value,
    portions: parseInt(document.getElementById('f-portions').value)||4,
    time: parseInt(document.getElementById('f-time').value)||0,
    notes: document.getElementById('f-notes').value.trim(),
    ingredients, steps,
    created: existingCreated || serverTimestamp()
  };
  try {
    await firestoreSave(recipe);
    closeSheet();
    showToast(currentEditId ? 'Oppskrift oppdatert!' : 'Oppskrift lagret!');
  } catch(e) { showToast('Feil: '+e.message); }
};

window.deleteRecipe = async function() {
  if (!confirm('Vil du slette denne oppskriften?')) return;
  try { await firestoreDelete(currentEditId); closeSheet(); showToast('Oppskrift slettet'); }
  catch(e) { showToast('Feil: '+e.message); }
};

window.openDetail = function(id) {
  const r = recipes.find(x=>x.id===id);
  if (!r) return;
  detailRecipe = r; currentDetailId = id; scaleMultiplier = 1;
  const hero = document.getElementById('detail-hero');
  if (r.image) hero.innerHTML = `<img src="${r.image}" alt="${r.name}">`;
  else hero.textContent = catEmoji(r.category);
  document.getElementById('d-title').textContent = r.name;
  document.getElementById('d-cat').textContent = r.category||'';
  document.getElementById('d-time').textContent = r.time ? '‚è± '+r.time+' min' : '';
  document.getElementById('d-portions-display').textContent = r.portions ? 'üë§ '+r.portions+' porsjoner' : '';
  const range = document.getElementById('scale-range');
  range.value = r.portions||4; range.max = Math.max(20,(r.portions||4)*4);
  document.getElementById('scale-val').textContent = r.portions||4;
  renderDetailIngredients(1);
  document.getElementById('d-steps').innerHTML = (r.steps||[]).map(s=>`<li>${s}</li>`).join('');
  document.getElementById('d-steps-section').style.display = r.steps?.length ? 'block' : 'none';
  document.getElementById('d-notes').textContent = r.notes||'';
  document.getElementById('d-notes-section').style.display = r.notes ? 'block' : 'none';
  document.getElementById('detail-overlay').classList.add('active');
  document.getElementById('detail-sheet').classList.add('active');
};

function renderDetailIngredients(mult) {
  if (!detailRecipe) return;
  document.getElementById('d-ingredients').innerHTML = (detailRecipe.ingredients||[]).map(i => {
    let amt = '';
    if (i.amount) {
      const num = parseFloat(i.amount.replace(',','.'));
      if (!isNaN(num)) { const s=num*mult; amt=(Number.isInteger(s)?s:Math.round(s*10)/10)+''; } else amt=i.amount;
    }
    return `<li><span>${i.name}</span><span class="ing-amount">${amt} ${i.unit||''}</span></li>`;
  }).join('');
  document.getElementById('d-ing-section').style.display = detailRecipe.ingredients?.length ? 'block' : 'none';
}

window.updateScale = function(val) {
  scaleMultiplier = val/(detailRecipe?.portions||4);
  document.getElementById('scale-val').textContent = val;
  renderDetailIngredients(scaleMultiplier);
};

window.closeDetail = function() {
  document.getElementById('detail-overlay').classList.remove('active');
  document.getElementById('detail-sheet').classList.remove('active');
};

// Legg inn din delte n√∏kkel her s√• alle kan bruke AI-scanning:
const SHARED_API_KEY = '';

function getApiKey() {
  return localStorage.getItem('anthropic_key') || SHARED_API_KEY;
}

window.toggleApiSection = function() {
  const sec = document.getElementById('api-key-section');
  sec.style.display = sec.style.display === 'none' ? 'block' : 'none';
};

window.saveApiKey = function() {
  const key = document.getElementById('api-key-input').value.trim();
  if (!key) return;
  localStorage.setItem('anthropic_key', key);
  document.getElementById('api-key-section').innerHTML = '<p style="color:var(--success)">‚úì API-n√∏kkel lagret! Klar til √• skanne.</p>';
  showToast('API-n√∏kkel lagret!');
};
window.saveApiKeyFromSettings = function() {
  localStorage.setItem('anthropic_key', document.getElementById('settings-api-key').value.trim());
};

window.handleImage = function(input) {
  const file = input.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    currentImageBase64 = e.target.result.split(',')[1];
    const prev = document.getElementById('preview-img');
    prev.src = e.target.result; prev.style.display = 'block';
    document.getElementById('ai-result').style.display = 'none';
    analyzeImage();
  };
  reader.readAsDataURL(file);
};

async function analyzeImage() {
  const key = getApiKey();
  if (!key) { showToast('Legg inn API-n√∏kkel f√∏rst!'); return; }
  document.getElementById('ai-loading').style.display = 'block';
  document.getElementById('ai-result').style.display = 'none';
  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({model:'claude-opus-4-5',max_tokens:2000,messages:[{role:'user',content:[
        {type:'image',source:{type:'base64',media_type:'image/jpeg',data:currentImageBase64}},
        {type:'text',text:`Les denne oppskriften og returner den som JSON (ingen markdown, kun ren JSON):\n{"name":"","category":"Middag","portions":4,"time":30,"ingredients":[{"amount":"2","unit":"dl","name":"mel"}],"steps":["Steg 1..."],"notes":""}\nBruk norske enheter. Kategori: Frokost, Lunsj, Middag, Dessert, Bakst, Snacks, Drikke, Annet.`}
      ]}]})
    });
    const data = await res.json();
    const text = data.content?.[0]?.text||'';
    try {
      parsedAiRecipe = JSON.parse(text.trim());
      document.getElementById('ai-recipe-title').textContent = parsedAiRecipe.name;
      document.getElementById('ai-text').textContent = `${parsedAiRecipe.ingredients?.length||0} ingredienser ¬∑ ${parsedAiRecipe.steps?.length||0} steg`;
    } catch { parsedAiRecipe=null; document.getElementById('ai-recipe-title').textContent=''; document.getElementById('ai-text').textContent=text; }
    document.getElementById('ai-result').style.display = 'block';
  } catch(e) { showToast('Noe gikk galt: '+e.message); }
  document.getElementById('ai-loading').style.display = 'none';
}

window.analyzeUrl = async function() {
  console.log('analyzeUrl called');
  const key = getApiKey();
  console.log('key:', key ? 'found' : 'missing');
  if (!key) { showToast('Legg inn API-n√∏kkel f√∏rst!'); return; }
  const url = document.getElementById('url-input').value.trim();
  console.log('url:', url);
  if (!url) { showToast('Lim inn en URL f√∏rst!'); return; }
  document.getElementById('ai-loading').style.display = 'block';
  document.getElementById('ai-result').style.display = 'none';
  document.getElementById('preview-img').style.display = 'none';
  try {
    let html = '';
    const fetchWithTimeout = (p, ms=10000) => Promise.race([p, new Promise((_,r)=>setTimeout(()=>r(new Error('timeout')),ms))]);
    const proxies = [
      () => fetchWithTimeout(fetch(`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`).then(r=>r.ok?r.text():Promise.reject(new Error('codetabs fail')))),
      () => fetchWithTimeout(fetch(`https://thingproxy.freeboard.io/fetch/${url}`).then(r=>r.ok?r.text():Promise.reject(new Error('thingproxy fail')))),
      () => fetchWithTimeout(fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`).then(r=>r.ok?r.text():Promise.reject(new Error('allorigins fail')))),
    ];
    let lastError = '';
    for (const tryP of proxies) {
      try { html=await tryP(); if(html) break; }
      catch(e) { lastError=e.message; continue; }
    }
    if (!html) throw new Error('Kunne ikke hente siden (' + lastError + '). Pr√∏v bilde-funksjonen i stedet.');
    const tmp = document.createElement('div'); tmp.innerHTML = html;
    tmp.querySelectorAll('script,style,nav,footer,header,aside').forEach(el=>el.remove());
    const text = (tmp.innerText||tmp.textContent||'').replace(/\s+/g,' ').trim().slice(0,6000);
    if (!text) { showToast('Kunne ikke lese siden.'); document.getElementById('ai-loading').style.display='none'; return; }
    const res = await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':key,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},
      body:JSON.stringify({model:'claude-opus-4-5',max_tokens:2000,messages:[{role:'user',content:`Du er en ekspert p√• norske oppskrifter. Ekstraher eller rekonstruer oppskriften fra denne teksten og returner KUN ren JSON (ingen markdown, ingen forklaring, ingen backticks). Selv om ingredienslisten mangler, SKAL du alltid fylle inn ingredienser basert p√• oppskriftsnavnet og fremgangsm√•ten - gjett mengder hvis n√∏dvendig.\n{"name":"","category":"Middag","portions":4,"time":30,"ingredients":[{"amount":"2","unit":"dl","name":"mel"}],"steps":["Steg 1..."],"notes":""}\nKategori: Frokost, Lunsj, Middag, Dessert, Bakst, Snacks, Drikke, Annet.\n\nTekst:\n${text}`}]})
    });
    const data = await res.json();
    const rt = data.content?.[0]?.text||'';
    console.log('AI response:', rt);
    try {
      const m = rt.match(/\{[\s\S]*\}/);
      parsedAiRecipe = JSON.parse(m?m[0]:rt.trim());
      document.getElementById('ai-recipe-title').textContent = parsedAiRecipe.name;
      document.getElementById('ai-text').textContent = `${parsedAiRecipe.ingredients?.length||0} ingredienser ¬∑ ${parsedAiRecipe.steps?.length||0} steg`;
    } catch(parseErr) {
      parsedAiRecipe=null;
      document.getElementById('ai-recipe-title').textContent='Kunne ikke tolke svar';
      document.getElementById('ai-text').textContent='R√•svar fra AI:\n'+rt;
    }
    document.getElementById('ai-result').style.display='block';
  } catch(e) { showToast('Noe gikk galt: '+e.message); }
  document.getElementById('ai-loading').style.display = 'none';
};

window.importAiRecipe = async function() {
  if (!parsedAiRecipe) { showToast('Ingen gyldig oppskrift funnet'); return; }
  try {
    const {id,...data} = parsedAiRecipe;
    await addDoc(recipesCol, {...data, created: serverTimestamp()});
    showToast('Oppskrift importert!'); showView('home');
  } catch(e) { showToast('Feil: '+e.message); }
};

window.exportData = function() {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([JSON.stringify(recipes,null,2)],{type:'application/json'}));
  a.download = 'oppskrifter.json'; a.click();
};

window.importData = function(input) {
  const file = input.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = async (e) => {
    try {
      const imported = JSON.parse(e.target.result);
      if (Array.isArray(imported)) {
        for (const r of imported) { const{id,...data}=r; await addDoc(recipesCol,{...data,created:serverTimestamp()}); }
        showToast(imported.length+' oppskrifter importert!');
      }
    } catch { showToast('Ugyldig fil'); }
  };
  reader.readAsText(file);
};

window.clearAllData = async function() {
  if (!confirm('Er du sikker? Dette sletter ALLE oppskrifter permanent fra skyen.')) return;
  try { for (const r of recipes) await deleteDoc(doc(db,'oppskrifter',r.id)); showToast('Alle oppskrifter slettet'); }
  catch(e) { showToast('Feil: '+e.message); }
};

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}
window.showToast = showToast;

window.addEventListener('DOMContentLoaded', () => {
  const settingsKey = document.getElementById('settings-api-key');
  if (settingsKey) settingsKey.value = localStorage.getItem('anthropic_key') || '';
  const key = localStorage.getItem('anthropic_key');
  if (key) document.getElementById('api-key-section').innerHTML = '<p style="color:var(--success)">‚úì API-n√∏kkel er lagret. Klar til √• skanne!</p>';
});

const mBlob = new Blob([JSON.stringify({name:'Oppskrifter',short_name:'Oppskrifter',start_url:'/',display:'standalone',background_color:'#1a1a0e',theme_color:'#1a1a0e',icons:[{src:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="%231a1a0e"/><text y=".9em" font-size="80" x="10">üçΩÔ∏è</text></svg>',sizes:'any',type:'image/svg+xml'}]})],{type:'application/json'});
const mLink = document.createElement('link'); mLink.rel='manifest'; mLink.href=URL.createObjectURL(mBlob); document.head.appendChild(mLink);
</script>
</body>
</html>
